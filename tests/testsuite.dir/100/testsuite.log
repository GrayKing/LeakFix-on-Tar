#                             -*- compilation -*-
100. rename02.at:24: testing move between hierarchies ...
./rename02.at:27:
mkdir gnu
(cd gnu
TEST_TAR_FORMAT=gnu
export TEST_TAR_FORMAT
TAR_OPTIONS="-H gnu"
export TAR_OPTIONS
rm -rf *


test -z "`sort < /dev/null 2>&1`" || exit 77

mkdir foo
genfile --file foo/file1
genfile --file foo/file2
mkdir foo/bar
genfile --file foo/bar/file.r
mkdir foo/bar/baz
genfile --file foo/bar/baz/file.z

sleep 1

echo "Creating base archive"
tar -g incr -cf arch.1 -v foo

mv foo/bar/baz foo

echo "Creating incremental archive"
tar -g incr -cf arch.2 -v foo

mv foo old

tar xfg arch.1 /dev/null --warning=no-timestamp 2>tmperr
sort tmperr >&2

echo "Begin directory listing 1"
find foo | sort
echo "End directory listing 1"

tar xfgv arch.2 /dev/null --warning=no-timestamp
echo Begin directory listing 2
find foo | sort
echo End directory listing 2
)
--- -	2015-11-24 15:39:19.082358594 +0800
+++ /root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/stderr	2015-11-24 15:39:19.078164233 +0800
@@ -1,5 +1,9 @@
+/root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/test-source: line 72: genfile: command not found
+/root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/test-source: line 73: genfile: command not found
+/root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/test-source: line 75: genfile: command not found
+/root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/test-source: line 77: genfile: command not found
 tar: foo: Directory is new
 tar: foo/bar: Directory is new
 tar: foo/bar/baz: Directory is new
-tar: foo/baz: Directory has been renamed from 'foo/bar/baz'
+tar: foo/baz: Directory has been renamed from `foo/bar/baz'
 
--- -	2015-11-24 15:39:19.083750882 +0800
+++ /root/Desktop/tar-1.28/tests/testsuite.dir/at-groups/100/stdout	2015-11-24 15:39:19.078164233 +0800
@@ -2,10 +2,6 @@
 foo/
 foo/bar/
 foo/bar/baz/
-foo/file1
-foo/file2
-foo/bar/file.r
-foo/bar/baz/file.z
 Creating incremental archive
 foo/
 foo/bar/
@@ -14,10 +10,6 @@
 foo
 foo/bar
 foo/bar/baz
-foo/bar/baz/file.z
-foo/bar/file.r
-foo/file1
-foo/file2
 End directory listing 1
 foo/
 foo/bar/
@@ -25,10 +17,6 @@
 Begin directory listing 2
 foo
 foo/bar
-foo/bar/file.r
 foo/baz
-foo/baz/file.z
-foo/file1
-foo/file2
 End directory listing 2
 
100. rename02.at:24: 100. move between hierarchies (rename02.at:24): expected failure (rename02.at:27)
